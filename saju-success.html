

<!DOCTYPE html>
<html lang="ko">
<head>

     <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5522499110435321"
     crossorigin="anonymous"></script>
     <meta http-equiv="Content-Security-Policy" content="
     default-src 'self' https://*;
     script-src 'self' 'unsafe-inline' 'unsafe-eval' https://*;
     style-src 'self' 'unsafe-inline' https://*;
     img-src 'self' data: https://*;
     connect-src 'self' https://*;
     frame-src 'self' https://*;
     ">
     <script src="https://nsp.pay.naver.com/sdk/js/naverpay.min.js"></script>




    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <title>테스트잇 정통 사주 리포트</title>
    <meta name="description" content="테스트잇 정통 사주 리포트">
<meta name="keywords" content="테스트잇,전체사주,정통사주,테스트잇사주,테스트잇전체사주,테스트잇사주,정확한사주,연애테스트,연애mbti,연애성격테스트, 심리테스트, mbti테스트">
    <meta property="og:type" content="website"> 
    <meta property="og:title" content="테스트잇 정통 사주 리포트">
    <meta property="og:description" content="테스트잇 정통 사주 리포트">
    <meta property="og:image" content="saju_main01.png">
    <meta property="og:url" content="https://test-it.co.kr/saju01">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
      <link rel="icon" type="image/png" href="favicon.png">
<link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet">



<style>

/* start 태그와 question 태그 모두 article 태그라서 article 태그에 속성을 주면 동시에 적용됨
.start{
    display: flex;
    flex-direction: column;
}
*/
    
   @font-face {
    font-family: 'ChosunGu';
    src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_20-04@1.0/ChosunGu.woff') format('woff');
    font-weight: normal;
    font-style: normal;
}
    
      body {
            font-family: 'ChosunGu', sans-serif;
        }
    
.logo {
    width: 100px;
    margin-top: 14px;
}

.main-nav {
    display: flex;
    font-size: 1.25rem;
    text-transform: uppercase;
    margin-top: 34px;
    list-style: none;
}

.main-nav li {
    margin-left: 36px;
       font-family: 'Do Hyeon', sans-serif;
    line-height: 1.7;
    color: #432;
}

.main-nav a{
    color: #432;
       font-family: 'Do Hyeon', sans-serif;
    line-height: 1.7;
}

.main-nav a:hover {
    color: #0bd;
}


.page-header {
    display: flex;
    justify-content: space-between;
}

    
article{
    display: flex;
    flex-direction: column;
}

 


.custom-jelly-button {
    width: 100%;
    max-width: 350px;
    height: 60px;
    font-size: 15px !important;
    font-weight: bold;
    color: black !important;
    background: linear-gradient(145deg, #ffcfcf, #ffcfcf); /* 분홍과 노랑 그라데이션 */
    border: none;
    border-radius: 17px;
    box-shadow: inset -4px -4px 10px rgba(255, 255, 255, 0.7), 
                inset 4px 4px 10px rgba(0, 0, 0, 0.1),
                2px 2px 8px rgba(0, 0, 0, 0.15);
    margin: 0 auto;
    display: block;
}

.custom-jelly-button:hover {
    background: linear-gradient(145deg, #ffcfcf, #ffcfcf); /* 반대로 그라데이션 */
}


.page {
            display: none;
            margin: 0 auto;
            max-width: 600px;
            padding: 20px;
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .active {
            display: block;
        }
        input, button {
            width: 80%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 10px;
            border: 1px solid #ddd;
        }

             /* 성공 페이지 전용 스타일 */
             .success-page {
            text-align: center;        /* 가운데 정렬 */
            margin: 40px auto;        /* 페이지 위아래 여백, 가운데 정렬 */
            max-width: 600px;         /* 폭 제한 */
            padding: 30px;            /* 안쪽 여백 */
            background-color: #fff;   /* 배경 흰색 */
            border-radius: 15px;      /* 모서리 둥글게 */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* 그림자 */
        }
        .success-title {
            font-size: 1.2rem;        /* 글씨 크기 */
            font-weight: bold;        /* 굵게 */
            margin-bottom: 10px;      /* 아래쪽 여백 */
        }
        .success-text {
            font-size: 1rem;          /* 본문 크기 */
            margin-bottom: 20px;      /* 간격 */
        }
        .success-link {
            display: inline-block;    
            padding: 10px 20px;
            background-color: #ffcfcf; /* 분홍빛 배경 */
            border-radius: 10px;
            text-decoration: none;      /* 밑줄 제거 */
            color: black;
            font-weight: bold;
            box-shadow: inset -4px -4px 10px rgba(255, 255, 255, 0.7),
                        inset 4px 4px 10px rgba(0, 0, 0, 0.1),
                        2px 2px 8px rgba(0, 0, 0, 0.15);
        }
        .success-link:hover {
            background: #ffbdbd;       /* hover 시 조금 진해짐 */
        }
    
    .at-share-btn-elements{
        text-align: center;
    }
.share{
    margin: 0 auto;
}

.kakao_ad{
    width: 320px;
    margin: 0 auto;
}

.kakao_ad2{
    width: 320px;
    margin: 0 auto;
}
.coupang_ad {
    width: 320px;
    margin: 0 auto;
}
        .custom-button {
            width: 100%;
            max-width: 350px;
            margin: 0 auto;
        }
    

  
</style>





</head>
<!-- body 태그 style background-color 지정으로 배경색 변경-->
<body class="container" style="background-color:#ffffff">
            
    <header class="page-header wrapper">
        <h1><a href="index.html"><img class="logo" src="img_logo.png" alt="test it"></a>
        </h1>
    <nav>
        <u1 class="main-nav">
            <li> <a href="https://test-it.co.kr/test.html">성격</a></li>
            <li> <a href="https://test-it.co.kr/face.html">얼굴</a></li>
            <li> <a href="https://test-it.co.kr/etc.html">그외</a></li>
            <li> <a href="https://test-it.co.kr/saju.html">사주</a></li>
        </u1>
    </nav>
        
        
    </header>

   <!-- 성공 페이지(가운데 정렬 + 꾸며주기) -->
   <div class="success-page">
    <h1 class="success-title">결제가 성공적으로 완료되었습니다!</h1>
    <p class="success-text">
        사주 신청이 완료되었습니다. 48시간 내에 이메일로 발송해 드릴게요.
    </p>
    <a class="success-link" href="https://test-it.co.kr/saju01">이전 페이지로 돌아가기</a>
</div>
     <script>
  
// ✅ 결제 성공 시에만 시트와 메일로 데이터 전송
const urlParams = new URLSearchParams(window.location.search);
const userName = urlParams.get("name");
const userGender = urlParams.get("gender");
const birthDate = urlParams.get("birth");
const birthType = urlParams.get("birthType");
const birthTime = urlParams.get("time");
const userEmail = urlParams.get("email");
const paymentItem = decodeURIComponent(urlParams.get("paymentItem") || "알 수 없는 항목");

console.log("✅ 석세스 페이지에서 전달된 값:");
console.log("이름:", userName);
console.log("성별:", userGender);
console.log("생년월일:", birthDate);
console.log("양력/음력:", birthType);
console.log("출생 시간:", birthTime);
console.log("이메일:", userEmail);
console.log(`🚀 결제 항목 확인: ${paymentItem}`);

// ✅ 결제 승인 함수 (승인 성공 후에만 데이터 전송)
async function confirmPayment() {
    const urlParams = new URLSearchParams(window.location.search);
    const paymentKey = urlParams.get("paymentKey");
    const orderId = urlParams.get("orderId");
    const amount = urlParams.get("amount");

    if (!paymentKey || !orderId || !amount) {
        console.error("❌ 결제 정보가 누락되었습니다.");
        alert("⚠️ 결제 정보가 누락되었습니다. 다시 시도해 주세요.");
        window.location.href = "https://test-it.co.kr/payment-fail1"; // ✅ 실패 페이지로 이동
        return;
    }

    console.log("🚀 결제 승인 요청:", { paymentKey, orderId, amount });

    try {
        const response = await fetch("https://api.tosspayments.com/v1/payments/confirm", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Basic " + btoa("live_gsk_DnyRpQWGrNL20vzK4mRb3Kwv1M9E:")  // 👉 라이브 시크릿 키 사용
            },
            body: JSON.stringify({
                paymentKey: paymentKey,
                orderId: orderId,
                amount: parseInt(amount)
            })
        });

        const result = await response.json();

        if (response.ok) {
            console.log("✅ 결제 승인 성공:", result);
            alert("🎉 결제가 성공적으로 완료되었습니다!");

            // ✅ Google Sheet로 데이터 전송 (결제 성공한 경우에만)
            sendToGoogleSheet(
                userData.name,
                userData.gender,
                userData.birth,
                userData.birthType,
                userData.time,
                userData.email,
                userData.paymentItem
            );

        } else {
            console.error("❌ 결제 승인 실패:", result);
            alert(`⚠️ 결제 승인 실패: ${result.message}`);
            window.location.href = "https://test-it.co.kr/payment-fail1"; // ✅ 실패 페이지로 이동
        }
    } catch (error) {
        console.error("❌ 결제 승인 중 오류 발생:", error);
        alert("⚠️ 결제 승인 중 오류가 발생했습니다.");
        window.location.href = "https://test-it.co.kr/payment-fail1"; // ✅ 실패 페이지로 이동
    }
}

// ✅ 페이지 로드 시 결제 승인 실행
window.onload = function() {
    confirmPayment();
};


function sendToGoogleSheet(userName, userGender, birthDate, birthType, birthTime, userEmail, paymentItem) {
    console.log("📤 전송할 데이터:", userName, userGender, birthDate, birthType, birthTime, userEmail, paymentItem);
    fetch("https://script.google.com/macros/s/AKfycbzSWc97F6-n1z0h6y0i2lhK7PJBkH31NNC6wkgygIa7mzYlifA5nbxqS1DcOcCUQ0vF/exec", {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            userName: userName,
            userGender: userGender,
            birthDate: birthDate,
            birthType: birthType,
            birthTime: birthTime,
            userEmail: userEmail,
            paymentItem: paymentItem,
            paymentTime: new Date().toLocaleString()
        })
    })
    .then(() => {
        console.log("✅ 구글 시트에 데이터 전송 완료!");
    })
    .catch(error => {
        console.error("❌ 데이터 전송 실패:", error);
    });
}

const userData = JSON.parse(sessionStorage.getItem("userData"));
if (userData && userData.name) {
  console.log("✅ 사용자 데이터:", userData);
  sendToGoogleSheet(
    userData.name,
    userData.gender,
    userData.birth,
    userData.birthType,
    userData.time,
    userData.email,
    userData.paymentItem
  );
} else {
  console.error("❌ 사용자 데이터가 없습니다.");
  alert("⚠️ 결제 성공 후 정보가 누락되었습니다!");
}



if (userName && userGender && birthDate && birthType && birthTime && userEmail && paymentItem) {
     // sendToGoogleSheet(userName, userGender, birthDate, birthType, birthTime, userEmail, paymentItem);
} else {
    // alert("⚠️ 결제 성공 후 정보가 누락되었습니다!");  // 주석 처리됨
}



   // 결제 성공 시 데이터 전송
fetch("https://script.google.com/macros/s/AKfycbzSWc97F6-n1z0h6y0i2lhK7PJBkH31NNC6wkgygIa7mzYlifA5nbxqS1DcOcCUQ0vF/exec", {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
        userName: userName,
        userGender: userGender,
        birthDate: birthDate,
        birthType: birthType,
        birthTime: birthTime,
        userEmail: userEmail,
        paymentItem: decodeURIComponent(paymentItem),  // ✅ 여기 디코딩 추가!
        paymentTime: new Date().toLocaleString()
})

})
.then(() => {
    console.log(`✅ 데이터 전송 완료! 결제 항목: ${paymentItem}`);
    // 원래 있던 alert 제거
})
.catch(error => {
    console.error("❌ 서버 통신 중 오류 발생:", error);
    // 원래 있던 alert 제거
});


</script>

</html>